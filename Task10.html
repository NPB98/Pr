<html>
    <head>
        <form onsubmit="saveToLocalStorage(event)">
            <label> Name</label>
            <input type="text" name="username" required>
            Email-Id<input type="text" name="emailId" required>
            Phone Number<input type="text" name="phnumbber" required>
            <button>Submit</button><br>
        </form>
        <ul id='listOfUsers'></ul>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.2/axios.min.js"></script>
        <script>
            /*axios.get("https://crudcrud.com/api/7c7553665cb140a2b92172bb17e5a067/appointmentDate")
            .then((response)=>{
                
                let arr=(response.data);
                let vallue;
                for(let i=0;i<arr.length;i++)
                {
                    vallue=arr[i];
                    document.body.innerHTML=document.body.innerHTML+vallue; 
                }
            })
            .catch((err)=>console.log(err));*/
            function saveToLocalStorage(e)
            {
                event.preventDefault();
                let myObj={
                    name:event.target.username.value,
                    email:event.target.emailId.value,
                };
                axios.post("https://crudcrud.com/api/7c7553665cb140a2b92172bb17e5a067/appointmentDate",myObj)
                .then((response)=>{
                    showNewUsersOnScreen(response.data);
                    //console.log(response)
                })
                .catch((err)=>{
                    document.body.innerHTML=document.body.innerHTML+"<h4>Something went wrong</h4>";
                    //console.log(err)
                });
                
                //localStorage.setItem(myObj.email,JSON.stringify(myObj));
                //showNewUsersOnScreen(myObj)
            }
            
            
            window.addEventListener("DOMContentLoaded", () => {
                axios.get("https://crudcrud.com/api/7c7553665cb140a2b92172bb17e5a067/appointmentDate")
                .then((response)=>{
                    for(var i=0;i<response.data.length;i++){
                        showNewUsersOnScreen(response.data[i]);
                    }
                    console.log(response);
                })
                .catch((err)=>console.log(err))
                //const localStorageObj = localStorage;
                //const localstoragekeys  = Object.keys(localStorageObj)

                //for(var i =0; i< localstoragekeys.length; i++){
                  //  const key = localstoragekeys[i]
                    //const userDetailsString = localStorageObj[key];
                   // const userDetailsObj = JSON.parse(userDetailsString);
                    //showNewUsersOnScreen(userDetailsObj)
                //}
            })
            function showNewUsersOnScreen(user)
            {
                /*if(localStorage.getItem(user.email!=null))
                {
                    removeUserFromScreen(user.email);
                }*/
                //document.getElementById('emailId').value=  '';
                //document.getElementById('username').value='';
                const parentNode=document.getElementById('listOfUsers');
                const childHTML=`<li id=${user._id}>${user.name} - ${user.email}
                    <button onclick=deleteUser('${user._id}')> Delete User </button>
                    <button onclick=editUserDetails('${user._id}','${user.name}')>Edit User </button>
                 </li>`
                parentNode.innerHTML=parentNode.innerHTML+childHTML;
                
            }
            function deleteUser(userId)
            {
                axios.delete(`https://crudcrud.com/api/7c7553665cb140a2b92172bb17e5a067/${user_Id}`)
                .then((response)=>{
                    console.log(response)
                    removeUserFromScreen(userId);
                })
                .catch((err)=>console.log(err));
                //console.log(emailId);
                //removeUserFromScreen(emailId);
                //localStorage.removeItem(emailId);
            }
            function removeUserFromScreen(userId)
            {
                const parentNode=document.getElementById('listOfUsers');
                const childNodeToBeDeleted=document.getElementById(userId); 
                //console.log(childNodeToBeDeleted);   
                if(childNodeToBeDeleted)
                {
                parentNode.removeChild(childNodeToBeDeleted);
                }
            }
            function editUserDetails(emailId, name){
                emailId=document.getElementById('email').value ;
                console.log(emailId);
                name=document.getElementById('username').value;
                console.log(name);
                deleteUser(emailId);
             }
            
        </script>
    </head>
</html>